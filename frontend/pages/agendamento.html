<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agendamento - Ramos Barbearia</title>

    <!-- CSS principal do projeto -->
    <link rel="stylesheet" href="../assets/style/style.css">
</head>

<body>

    <!-- HEADER / NAVBAR -->
    <header>
        <nav id="navbar">
            <img src="../assets/img/logo.png" alt="Ramos Barbearia" class="logo-nav">

            <ul>
                <li><a href="../index.html">Home</a></li>
                <li><a href="../index.html#servicos">Serviços</a></li>
            </ul>

            <a href="../index.html" class="cta-agendar">Voltar</a>
        </nav>
    </header>

    <!-- CONTEÚDO PRINCIPAL -->
    <main style="padding:120px 5%;">

        <h1>Agendamento pelo site</h1>
        <p>Preencha o formulário abaixo para solicitar seu horário.</p>

        <!-- FORMULÁRIO DE AGENDAMENTO -->
        <form id="form-agendamento" style="max-width:600px;">

            <!-- Nome -->
            <label for="nome">Nome completo</label>
            <input
                id="nome"
                type="text"
                required
                placeholder="Seu nome"
                class="input-dark"
            >

            <!-- Telefone -->
            <label for="telefone">Telefone</label>
            <input
                id="telefone"
                type="tel"
                required
                placeholder="(XX) XXXXX-XXXX"
                class="input-dark"
            >

            <!-- Serviço -->
            <label for="servico">Serviço</label>
            <select id="servico" class="input-dark" required>
                <option value="">Selecione um serviço</option>
                <option value="1">Corte Clássico</option>
                <option value="2">Barba Terapia</option>
                <option value="3">Combo Ramos</option>
            </select>

            <!-- Data -->
            <label for="data">Data desejada</label>
            <input id="data" type="date" class="input-dark" required>

            <!-- Hora -->
            <label for="hora">Horário</label>
            <input id="hora" type="time" class="input-dark" required>

            <!-- Botão -->
            <button type="submit" class="btn-primary" style="margin-top:15px;">
                Confirmar agendamento
            </button>
        </form>

        <!-- WhatsApp -->
        <p style="margin-top:20px;">
            Ou
            <a
                href="https://wa.me/5132472310?text=Olá! Gostaria de agendar um horário na Ramos Barbearia."
                class="btn-whatsapp"
                target="_blank"
            >
                agendar via WhatsApp
            </a>
        </p>

    </main>

    <!-- FOOTER -->
    <footer style="padding:20px;text-align:center;border-top:1px solid #222;">
        <p>&copy; 2024 Ramos Barbearia - Todos os direitos reservados.</p>
    </footer>

    <!-- SCRIPT DE AGENDAMENTO -->
    <script>
        /**
         * Verifica se o usuário está logado
         * Se não estiver, redireciona para login
         */
        const token = localStorage.getItem('token');

        if (!token) {
            window.location.href = '../login.html?next=pages/agendamento.html';
        }

        /**
         * Envio do formulário
         */
        document.getElementById('form-agendamento').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Captura dos dados
            const nome = document.getElementById('nome').value.trim();
            const telefone = document.getElementById('telefone').value.trim();
            const id_servico = document.getElementById('servico').value;
            const data = document.getElementById('data').value;
            const hora = document.getElementById('hora').value;

            // Validações básicas
            if (!nome || !telefone || !id_servico || !data || !hora) {
                alert('Preencha todos os campos.');
                return;
            }

            try {
                // Envio para o backend
                const response = await fetch('http://localhost:3000/agendamentos', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + token
                    },
                    body: JSON.stringify({
                        nome,
                        telefone,
                        id_servico,
                        data,
                        hora
                    })
                });

                const result = await response.json();

                if (response.ok) {
                    alert('Agendamento realizado com sucesso!');
                    document.getElementById('form-agendamento').reset();
                } else {
                    alert(result.erro || 'Erro ao realizar agendamento.');
                }

            } catch (error) {
                alert('Erro de conexão com o servidor.');
                console.error(error);
            }
        });
    </script>

</body>
</html>
